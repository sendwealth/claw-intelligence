name: Weekly CEO Report

on:
  schedule:
    # Every Sunday at 10:00 AM Beijing time (02:00 UTC)
    - cron: '0 2 * * 0'
  workflow_dispatch:

jobs:
  generate-report:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read

    steps:
      - uses: actions/checkout@v4

      - name: Generate Weekly Report
        uses: actions/github-script@v7
        with:
          script: |
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

            // Get issues created in the last week
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'all',
              since: oneWeekAgo.toISOString()
            });

            const newIssues = issues.data.filter(i => 
              new Date(i.created_at) >= oneWeekAgo && !i.pull_request
            );

            const openIssues = issues.data.filter(i => 
              i.state === 'open' && !i.pull_request
            );

            const closedIssues = issues.data.filter(i => 
              i.state === 'closed' && !i.pull_request &&
              new Date(i.closed_at) >= oneWeekAgo
            );

            const report = `# ğŸ“Š CLAW.AI å‘¨æŠ¥

**æ—¥æœŸï¼š** ${new Date().toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' })}
**ç”Ÿæˆè€…ï¼š** uc (AI CEO) ğŸ‹

---

## ğŸ“ˆ æœ¬å‘¨æ•°æ®

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| æ–°å¢å’¨è¯¢ | ${newIssues.length} |
| å¾…å¤„ç† | ${openIssues.length} |
| å·²å®Œæˆ | ${closedIssues.length} |

---

## ğŸ†• æ–°å¢å’¨è¯¢

${newIssues.length > 0 ? 
  newIssues.map(i => `- [#${i.number}](${i.html_url}) ${i.title}`).join('\n') :
  '*æœ¬å‘¨æ— æ–°å’¨è¯¢*'}

---

## â³ å¾…å¤„ç†äº‹é¡¹

${openIssues.length > 0 ?
  openIssues.map(i => `- [#${i.number}](${i.html_url}) ${i.title}`).join('\n') :
  '*æ— å¾…å¤„ç†äº‹é¡¹* ğŸ‰'}

---

## âœ… å·²å®Œæˆ

${closedIssues.length > 0 ?
  closedIssues.map(i => `- [#${i.number}](${i.html_url}) ${i.title}`).join('\n') :
  '*æœ¬å‘¨æ— å®Œæˆäº‹é¡¹*'}

---

## ğŸ¯ ä¸‹å‘¨è®¡åˆ’

- [ ] è·Ÿè¿›æ‰€æœ‰å¾…å¤„ç†å’¨è¯¢
- [ ] å‘å¸ƒæŠ€æœ¯æ–‡ç« 
- [ ] ç¤¾äº¤åª’ä½“æ¨å¹¿
- [ ] ä¼˜åŒ–ç½‘ç«™ SEO

---

## ğŸ’° æ”¶å…¥è¿½è¸ª

*è¯·æ‰‹åŠ¨æ›´æ–°æœ¬å‘¨æ”¶å…¥æ•°æ®*

| é¡¹ç›® | é‡‘é¢ |
|------|------|
| å’¨è¯¢æ”¶å…¥ | Â¥? |
| ä»£ç å‡ºå”® | Â¥? |
| **æ€»è®¡** | **Â¥?** |

---

*è‡ªåŠ¨åŒ–ç”Ÿæˆ by CLAW.AI CEO* ğŸ¤–
`;

            // Create issue for the report
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: `ğŸ“Š å‘¨æŠ¥ - ${new Date().toLocaleDateString('zh-CN', { timeZone: 'Asia/Shanghai' })}`,
              body: report,
              labels: ['weekly-report']
            });

            console.log('âœ… Weekly report generated!');
