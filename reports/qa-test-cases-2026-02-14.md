# CLAW.AI 项目测试用例

**文档版本**: 1.0
**创建日期**: 2026-02-14
**关联文档**: [测试计划](./qa-test-plan-2026-02-14.md)

---

## 1. 测试用例概览

| 模块 | 用例数量 | 自动化 | 优先级 |
|-----|---------|-------|-------|
| 用户认证 | 15 | 是 | P0/P1 |
| 对话管理 | 12 | 是 | P0/P1 |
| 知识库 | 18 | 是 | P0/P1 |
| AI 对话 | 20 | 是 | P0/P1 |
| 用户管理 | 10 | 部分 | P1/P2 |
| 系统管理 | 8 | 否 | P2 |
| 性能测试 | 10 | 是 | P1 |
| 安全测试 | 15 | 是 | P0 |
| **总计** | **108** | **90+** | - |

---

## 2. 用户认证模块

### TC-AUTH-001: 用户注册 - 正常流程
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 系统正常运行
- 未注册的邮箱地址

**测试步骤**:
1. 打开注册页面
2. 输入有效的邮箱地址
3. 输入密码（8-20位，包含字母和数字）
4. 确认密码
5. 点击注册按钮
6. 检查邮箱验证邮件
7. 点击验证链接

**预期结果**:
- 注册成功
- 跳转到登录页面
- 数据库中创建用户记录
- 发送验证邮件

---

### TC-AUTH-002: 用户注册 - 邮箱已存在
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已存在的用户邮箱

**测试步骤**:
1. 打开注册页面
2. 输入已注册的邮箱地址
3. 输入密码
4. 确认密码
5. 点击注册按钮

**预期结果**:
- 提示"邮箱已被注册"
- 不创建新用户记录

---

### TC-AUTH-003: 用户注册 - 密码强度不足
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 打开注册页面
2. 输入邮箱
3. 输入弱密码（如: 123456）
4. 确认密码
5. 点击注册按钮

**预期结果**:
- 提示"密码强度不足，需8-20位，包含字母和数字"
- 注册失败

---

### TC-AUTH-004: 用户登录 - 正确凭证
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已注册的用户

**测试步骤**:
1. 打开登录页面
2. 输入正确的邮箱
3. 输入正确的密码
4. 点击登录按钮

**预期结果**:
- 登录成功
- 获取 JWT Token
- 跳转到首页
- 用户状态更新为"在线"

---

### TC-AUTH-005: 用户登录 - 错误密码
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 打开登录页面
2. 输入正确的邮箱
3. 输入错误的密码
4. 点击登录按钮

**预期结果**:
- 提示"邮箱或密码错误"
- 不返回 JWT Token
- 登录失败次数+1

---

### TC-AUTH-006: JWT Token 刷新
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已登录用户

**测试步骤**:
1. 获取 Access Token 和 Refresh Token
2. 等待 Access Token 过期
3. 使用 Refresh Token 刷新
4. 验证新 Token 有效性

**预期结果**:
- 成功获取新的 Access Token
- 新 Token 包含正确的用户信息
- 旧 Token 失效

---

### TC-AUTH-007: Token 过期处理
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 使用过期的 Access Token 访问 API
2. 检查响应

**预期结果**:
- 返回 401 Unauthorized
- 响应体包含"Token expired"提示
- 触发自动刷新逻辑

---

### TC-AUTH-008: 密码重置 - 正常流程
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 打开密码重置页面
2. 输入注册邮箱
3. 点击发送重置链接
4. 检查邮箱
5. 点击重置链接
6. 输入新密码
7. 确认新密码
8. 提交

**预期结果**:
- 发送重置邮件
- 重置链接有效期正确
- 密码更新成功
- 使用新密码可登录

---

### TC-AUTH-009: 登出
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已登录用户

**测试步骤**:
1. 点击登出按钮
2. 检查本地存储
3. 尝试访问需要认证的 API

**预期结果**:
- 清除本地 Token
- 返回登录页面
- API 返回 401 Unauthorized

---

### TC-AUTH-010: 多设备登录检测
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 在设备 A 登录
2. 在设备 B 使用同一账号登录
3. 检查设备 A 的状态

**预期结果**:
- 支持多设备同时在线（根据业务需求）
- 或提示"账号在另一设备登录"

---

### TC-AUTH-011: 登录失败次数限制
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 连续输入错误密码 5 次
2. 第 6 次尝试登录

**预期结果**:
- 第 5 次后锁定账号或显示验证码
- 提示"登录失败次数过多，请稍后再试"

---

### TC-AUTH-012: 邮箱验证 - 过期链接
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 获取验证邮件
2. 等待验证链接过期（24小时）
3. 点击过期链接

**预期结果**:
- 提示"验证链接已过期"
- 引导重新发送验证邮件

---

### TC-AUTH-013: 第三方登录 - GitHub（如支持）
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 点击 GitHub 登录
2. 授权 GitHub 账号
3. 验证自动登录

**预期结果**:
- 成功获取 GitHub 用户信息
- 创建或关联本地账号
- 自动登录

---

### TC-AUTH-014: 权限验证 - 普通用户
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 以普通用户登录
2. 尝试访问管理员 API

**预期结果**:
- 返回 403 Forbidden
- 提示"权限不足"

---

### TC-AUTH-015: 权限验证 - 管理员
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 以管理员登录
2. 访问管理员 API

**预期结果**:
- 成功访问
- 返回正确的管理数据

---

## 3. 对话管理模块

### TC-CONV-001: 创建对话 - 正常流程
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 登录系统
2. 点击"新建对话"
3. 输入对话标题
4. 确认创建

**预期结果**:
- 对话创建成功
- 显示在对话列表
- 对话 ID 正确生成
- 数据库记录创建

---

### TC-CONV-002: 创建对话 - 空标题
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 点击"新建对话"
2. 不输入标题
3. 确认创建

**预期结果**:
- 自动生成默认标题（如: 新对话 1）
- 或提示"请输入对话标题"

---

### TC-CONV-003: 删除对话
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已有对话

**测试步骤**:
1. 选择要删除的对话
2. 点击删除
3. 确认删除

**预期结果**:
- 对话删除成功
- 从列表中移除
- 数据库记录删除或标记为已删除

---

### TC-CONV-004: 删除对话 - 他人对话
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 用户 A 创建对话
2. 用户 B 尝试删除 A 的对话

**预期结果**:
- 返回 403 Forbidden
- 提示"无权删除他人对话"
- 对话未被删除

---

### TC-CONV-005: 对话列表分页
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 创建 >20 个对话

**测试步骤**:
1. 查看对话列表
2. 检查分页功能

**预期结果**:
- 每页显示默认数量（如 10 条）
- 分页功能正常
- 总数显示正确

---

### TC-CONV-006: 对话搜索
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 输入搜索关键词
2. 执行搜索

**预期结果**:
- 显示匹配的对话
- 搜索结果高亮关键词
- 无结果时提示"未找到匹配对话"

---

### TC-CONV-007: 对话标题修改
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 选择对话
2. 编辑标题
3. 保存

**预期结果**:
- 标题更新成功
- 列表显示新标题

---

### TC-CONV-008: 对话历史加载
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 对话有多轮历史记录

**测试步骤**:
1. 选择对话
2. 加载历史记录

**预期结果**:
- 加载完整历史
- 按时间顺序显示
- 最新消息在底部

---

### TC-CONV-009: 对话导出
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 选择对话
2. 点击导出
3. 选择格式（PDF/Markdown/JSON）
4. 下载

**预期结果**:
- 文件生成成功
- 内容完整
- 格式正确

---

### TC-CONV-010: 对话共享
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 选择对话
2. 生成共享链接
3. 用户 B 使用链接访问

**预期结果**:
- 链接生成成功
- 用户 B 可查看（只读）
- 链接过期时间正确

---

### TC-CONV-011: 对话收藏
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 选择对话
2. 点击收藏
3. 查看收藏列表

**预期结果**:
- 对话标记为已收藏
- 显示在收藏列表
- 取消收藏后移除

---

### TC-CONV-012: 对话归档
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 选择对话
2. 点击归档

**预期结果**:
- 对话移至归档列表
- 不在常规列表显示
- 可恢复归档

---

## 4. 知识库模块

### TC-KB-001: 文件上传 - PDF 文件
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 登录系统
2. 进入知识库页面
3. 上传 PDF 文件（<10MB）
4. 等待处理

**预期结果**:
- 文件上传成功
- 解析成功
- 向量化成功
- 显示在知识库列表

---

### TC-KB-002: 文件上传 - 文本文件
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 上传 .txt 文件
2. 等待处理

**预期结果**:
- 文件上传成功
- 内容解析成功
- 向量化成功

---

### TC-KB-003: 文件上传 - Word 文档
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 上传 .docx 文件
2. 等待处理

**预期结果**:
- 文件上传成功
- 文档内容解析成功
- 向量化成功

---

### TC-KB-004: 文件上传 - 超大文件
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 尝试上传 >10MB 文件

**预期结果**:
- 提示"文件大小超过限制（最大 10MB）"
- 不执行上传

---

### TC-KB-005: 文件上传 - 不支持格式
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 尝试上传 .exe 文件

**预期结果**:
- 提示"不支持的文件格式"
- 不执行上传

---

### TC-KB-006: 批量上传
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 选择多个文件（<5 个）
2. 批量上传

**预期结果**:
- 所有文件上传成功
- 逐个处理
- 显示处理进度

---

### TC-KB-007: 文件删除
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已上传文件

**测试步骤**:
1. 选择文件
2. 点击删除
3. 确认

**预期结果**:
- 文件删除成功
- 从知识库移除
- 向量数据删除

---

### TC-KB-008: 知识库检索
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已有知识库文件

**测试步骤**:
1. 在对话中提问
2. 触发知识库检索
3. 查看引用来源

**预期结果**:
- 返回相关文档片段
- 显示引用来源
- 相关性评分合理

---

### TC-KB-009: 知识库更新
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已上传文件

**测试步骤**:
1. 重新上传同名文件
2. 检查知识库

**预期结果**:
- 覆盖旧文件
- 重新向量化
- 检索结果更新

---

### TC-KB-010: 文件处理失败处理
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 上传损坏的 PDF 文件
2. 检查处理状态

**预期结果**:
- 显示"处理失败"
- 提示错误原因
- 允许重新上传

---

### TC-KB-011: 知识库分类/标签
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 上传文件
2. 添加分类/标签
3. 按分类筛选

**预期结果**:
- 分类创建成功
- 筛选功能正常
- 标签显示正确

---

### TC-KB-012: 知识库搜索
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 输入搜索关键词
2. 搜索知识库

**预期结果**:
- 返回匹配的文档
- 高亮关键词
- 相关度排序

---

### TC-KB-013: 向量数据库连接测试
**优先级**: P1
**测试类型**: 集成测试
**自动化**: 是

**测试步骤**:
1. 连接 Milvus
2. 插入测试向量
3. 查询向量

**预期结果**:
- 连接成功
- 插入成功
- 查询返回相似结果

---

### TC-KB-014: 文件解析准确性
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 上传复杂 PDF（含表格、图片）
2. 检查解析结果

**预期结果**:
- 文本提取完整
- 格式保留较好
- 错误率 < 5%

---

### TC-KB-015: 知识库统计
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 查看知识库统计页面

**预期结果**:
- 显示文件总数
- 显示总大小
- 显示向量数量
- 显示更新时间

---

### TC-KB-016: 知识库导出
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 选择文件
2. 点击导出

**预期结果**:
- 导出成功
- 文件完整

---

### TC-KB-017: 知识库权限 - 私有
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 用户 A 创建私有知识库
2. 用户 B 尝试访问

**预期结果**:
- 用户 B 无法访问
- 返回 403 Forbidden

---

### TC-KB-018: 知识库权限 - 团队共享
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 创建团队知识库
2. 用户 A 上传文件
3. 用户 B 查询

**预期结果**:
- 用户 B 可访问
- 检索结果包含 A 的文件

---

## 5. AI 对话模块

### TC-CHAT-001: 单轮对话 - 简单问题
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 选择对话
2. 输入简单问题
3. 发送

**预期结果**:
- AI 返回回答
- 回答相关
- 响应时间 < 3s

---

### TC-CHAT-002: 单轮对话 - 复杂问题
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 输入复杂问题
2. 发送

**预期结果**:
- AI 返回详细回答
- 逻辑清晰
- 有引用来源（如启用知识库）

---

### TC-CHAT-003: 多轮对话 - 上下文记忆
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 第一轮: "什么是机器学习？"
2. 第二轮: "它有哪些应用？"

**预期结果**:
- 第二轮理解"它"指代机器学习
- 回答相关

---

### TC-CHAT-004: 流式响应
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 发送长问题
2. 观察响应

**预期结果**:
- 逐步显示回答
- 流畅无卡顿
- 最后一段完整

---

### TC-CHAT-005: 空输入处理
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 发送空消息
2. 或仅空格

**预期结果**:
- 提示"请输入消息"
- 或不发送

---

### TC-CHAT-006: 长文本输入
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 输入超长文本（>10000 字）
2. 发送

**预期结果**:
- 提示"超出长度限制"
- 或截断后发送
- 返回合理回答

---

### TC-CHAT-007: 特殊字符输入
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 输入特殊字符（@#$%^&*）
2. 发送

**预期结果**:
- 不报错
- 安全过滤
- 返回回答

---

### TC-CHAT-008: 响应超时
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 模拟 AI 服务超时
2. 发送消息

**预期结果**:
- 提示"响应超时，请重试"
- 显示错误提示
- 不丢失输入

---

### TC-CHAT-009: 消息重新生成
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 发送消息
2. 点击重新生成

**预期结果**:
- 重新请求 AI
- 返回不同回答
- 历史消息保留

---

### TC-CHAT-010: 消息编辑
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 编辑已发送消息
2. 重新发送

**预期结果**:
- 消息更新
- 重新获取回答
- 历史消息更新

---

### TC-CHAT-011: 消息复制
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 点击回答复制按钮

**预期结果**:
- 复制到剪贴板
- 提示"已复制"

---

### TC-CHAT-012: 消息点赞/点踩
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 点击回答的点赞/点踩

**预期结果**:
- 点赞数+1
- 或反馈收集成功

---

### TC-CHAT-013: 知识库引用验证
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 已上传知识库

**测试步骤**:
1. 提问相关内容
2. 检查引用来源

**预期结果**:
- 显示引用来源
- 点击可跳转
- 来源内容匹配

---

### TC-CHAT-014: Markdown 渲染
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 请求包含 Markdown 的回答

**预期结果**:
- Markdown 正确渲染
- 代码高亮
- 表格显示

---

### TC-CHAT-015: 图片输入（如支持）
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 上传图片
2. 输入问题
3. 发送

**预期结果**:
- 图片识别成功
- 回答相关

---

### TC-CHAT-016: 对话暂停/恢复
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 暂停对话
2. 继续对话

**预期结果**:
- 暂停后不发送新请求
- 恢复后可继续

---

### TC-CHAT-017: 对话切换
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 打开对话 A
2. 切换到对话 B
3. 返回对话 A

**预期结果**:
- 对话状态保留
- 历史消息完整

---

### TC-CHAT-018: API 调用统计
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 查看使用统计

**预期结果**:
- 显示调用次数
- 显示 Token 使用量
- 显示费用预估

---

### TC-CHAT-019: 模型选择（如支持）
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 切换模型
2. 发送消息

**预期结果**:
- 使用指定模型
- 回答风格不同

---

### TC-CHAT-020: 敏感词过滤
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 输入敏感词
2. 发送

**预期结果**:
- 提示"内容包含敏感词"
- 或自动替换

---

## 6. 用户管理模块

### TC-USER-001: 查看个人信息
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 登录
2. 查看个人资料

**预期结果**:
- 显示用户名
- 显示邮箱
- 显示注册时间

---

### TC-USER-002: 修改个人信息
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 进入个人资料页面
2. 修改昵称
3. 保存

**预期结果**:
- 修改成功
- 更新显示

---

### TC-USER-003: 修改密码
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 输入旧密码
2. 输入新密码
3. 确认新密码
4. 提交

**预期结果**:
- 密码更新成功
- 使用新密码可登录
- 旧密码失效

---

### TC-USER-004: 删除账号
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 请求删除账号
2. 确认删除

**预期结果**:
- 账号删除
- 数据清理
- 无法登录

---

### TC-USER-005: 导出用户数据
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 请求导出数据
2. 下载

**预期结果**:
- 生成数据包
- 包含对话、知识库等
- JSON/ZIP 格式

---

### TC-USER-006: 用户列表（管理员）
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 管理员登录

**测试步骤**:
1. 访问用户列表
2. 分页查看

**预期结果**:
- 显示所有用户
- 分页正常
- 可搜索

---

### TC-USER-007: 用户禁用/启用（管理员）
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 管理员登录

**测试步骤**:
1. 禁用用户
2. 用户尝试登录

**预期结果**:
- 用户无法登录
- 提示"账号已被禁用"

---

### TC-USER-008: 角色分配（管理员）
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 管理员登录

**测试步骤**:
1. 分配管理员角色
2. 用户验证权限

**预期结果**:
- 角色更新成功
- 权限生效

---

### TC-USER-009: 用户统计（管理员）
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 管理员登录

**测试步骤**:
1. 查看用户统计

**预期结果**:
- 显示总用户数
- 显示活跃用户
- 显示新增用户

---

### TC-USER-010: 批量操作（管理员）
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**前置条件**:
- 管理员登录

**测试步骤**:
1. 选择多个用户
2. 批量禁用/删除

**预期结果**:
- 操作成功
- 批量更新

---

## 7. 系统管理模块

### TC-SYS-001: 系统健康检查
**优先级**: P0
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 访问 /health 端点

**预期结果**:
- 返回 200 OK
- 显示各服务状态

---

### TC-SYS-002: 数据库连接测试
**优先级**: P0
**测试类型**: 集成测试
**自动化**: 是

**测试步骤**:
1. 测试数据库连接

**预期结果**:
- 连接成功
- 可执行查询

---

### TC-SYS-003: Redis 连接测试
**优先级**: P0
**测试类型**: 集成测试
**自动化**: 是

**测试步骤**:
1. 测试 Redis 连接

**预期结果**:
- 连接成功
- 可读写缓存

---

### TC-SYS-004: 日志查看
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 查看系统日志

**预期结果**:
- 日志正常记录
- 可按级别筛选

---

### TC-SYS-005: 监控指标
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 是

**测试步骤**:
1. 查看 Grafana 仪表板

**预期结果**:
- 指标正常显示
- 无异常告警

---

### TC-SYS-006: 配置管理
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 修改系统配置
2. 重启服务

**预期结果**:
- 配置生效
- 服务正常运行

---

### TC-SYS-007: 备份恢复
**优先级**: P1
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 备份数据库
2. 删除数据
3. 恢复备份

**预期结果**:
- 备份成功
- 恢复成功
- 数据完整

---

### TC-SYS-008: 通知设置
**优先级**: P2
**测试类型**: 功能测试
**自动化**: 部分

**测试步骤**:
1. 配置邮件通知
2. 触发告警
3. 检查邮件

**预期结果**:
- 邮件发送成功
- 内容正确

---

## 8. 性能测试

### TC-PERF-001: API 响应时间 - 正常负载
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 使用 Locust 模拟 100 并发用户
2. 执行 10 分钟
3. 收集指标

**预期结果**:
- P95 响应时间 < 200ms
- P99 响应时间 < 500ms
- 无错误

---

### TC-PERF-002: API 响应时间 - 高负载
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 使用 Locust 模拟 500 并发用户
2. 执行 10 分钟

**预期结果**:
- P95 响应时间 < 500ms
- 错误率 < 1%

---

### TC-PERF-003: 数据库查询性能
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 测试常见查询性能

**预期结果**:
- 查询时间 < 100ms
- 慢查询记录

---

### TC-PERF-004: 缓存命中率
**优先级**: P2
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 执行多次相同请求
2. 检查缓存命中率

**预期结果**:
- 命中率 > 80%

---

### TC-PERF-005: 文件上传性能
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 上传 5MB 文件
2. 记录时间

**预期结果**:
- 上传时间 < 5s
- 处理时间 < 30s

---

### TC-PERF-006: 向量检索性能
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 执行向量检索
2. 记录时间

**预期结果**:
- 检索时间 < 200ms

---

### TC-PERF-007: 并发对话性能
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 模拟 100 个并发对话
2. 每个对话 10 轮

**预期结果**:
- 所有对话完成
- 无超时
- 响应时间合理

---

### TC-PERF-008: 系统稳定性
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 持续运行 24 小时
2. 监控资源使用

**预期结果**:
- 无崩溃
- 无内存泄漏
- 资源使用稳定

---

### TC-PERF-009: 峰值负载
**优先级**: P1
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 突增并发至 1000 用户
2. 观察 5 分钟

**预期结果**:
- 系统稳定
- 响应时间可接受
- 无崩溃

---

### TC-PERF-010: 资源限制
**优先级**: P2
**测试类型**: 性能测试
**自动化**: 是

**测试步骤**:
1. 限制 CPU/内存
2. 执行测试

**预期结果**:
- 在限制下仍可运行
- 降级策略生效

---

## 9. 安全测试

### TC-SEC-001: SQL 注入防护
**优先级**: P0
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 在输入框输入 SQL 注入语句
2. 提交

**预期结果**:
- 不执行注入
- 记录安全日志
- 无数据库泄露

---

### TC-SEC-002: XSS 防护
**优先级**: P0
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 输入 XSS 脚本
2. 提交

**预期结果**:
- 脚本不执行
- 转义显示
- 记录安全日志

---

### TC-SEC-003: CSRF 防护
**优先级**: P0
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 构造 CSRF 请求
2. 发送

**预期结果**:
- 请求被拒绝
- 提示 CSRF 错误

---

### TC-SEC-004: JWT Token 安全
**优先级**: P0
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 尝试篡改 Token
2. 使用篡改的 Token 访问

**预期结果**:
- Token 验证失败
- 返回 401 Unauthorized

---

### TC-SEC-005: 敏感数据加密
**优先级**: P0
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 检查数据库密码
2. 检查传输加密

**预期结果**:
- 密码哈希存储
- HTTPS 加密传输

---

### TC-SEC-006: API 速率限制
**优先级**: P1
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 短时间内发送大量请求

**预期结果**:
- 触发速率限制
- 返回 429 Too Many Requests
- 提示"请求过于频繁"

---

### TC-SEC-007: 文件上传安全
**优先级**: P0
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 尝试上传恶意文件
2. 尝试上传超路径文件

**预期结果**:
- 拒绝恶意文件
- 路径遍历失败
- 记录安全日志

---

### TC-SEC-008: 权限验证
**优先级**: P0
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 用户 A 尝试访问用户 B 的资源

**预期结果**:
- 返回 403 Forbidden
- 资源不可访问

---

### TC-SEC-009: HTTPS 强制
**优先级**: P1
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 尝试 HTTP 访问

**预期结果**:
- 重定向到 HTTPS
- 或拒绝 HTTP

---

### TC-SEC-010: CORS 配置
**优先级**: P1
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 从未授权域名访问 API

**预期结果**:
- 浏览器阻止请求
- CORS 错误

---

### TC-SEC-011: 敏感信息泄露
**优先级**: P1
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 检查错误响应
2. 检查日志

**预期结果**:
- 不暴露敏感信息
- 不暴露堆栈跟踪
- 不暴露 API Key

---

### TC-SEC-012: 会话固定攻击
**优先级**: P1
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 获取 Session ID
2. 登录
3. 检查 Session ID 是否变化

**预期结果**:
- Session ID 登录后变化
- 防止固定攻击

---

### TC-SEC-013: 依赖库漏洞扫描
**优先级**: P1
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 使用 Snyk 扫描依赖

**预期结果**:
- 无高危漏洞
- 中危漏洞修复或评估

---

### TC-SEC-014: 代码安全扫描
**优先级**: P1
**测试类型**: 安全测试
**自动化**: 是

**测试步骤**:
1. 使用 Bandit 扫描 Python 代码

**预期结果**:
- 无高危安全问题
- 修复警告

---

### TC-SEC-015: API 文档安全
**优先级**: P2
**测试类型**: 安全测试
**自动化**: 部分

**测试步骤**:
1. 检查 API 文档

**预期结果**:
- 生产环境不暴露敏感端点
- 文档不暴露内部信息

---

## 10. 总结

### 10.1 用例统计

| 模块 | 用例数 | P0 | P1 | P2 | 自动化 |
|-----|-------|----|----|----|-------|
| 用户认证 | 15 | 3 | 6 | 6 | 13 |
| 对话管理 | 12 | 3 | 4 | 5 | 11 |
| 知识库 | 18 | 4 | 6 | 8 | 16 |
| AI 对话 | 20 | 5 | 7 | 8 | 18 |
| 用户管理 | 10 | 0 | 5 | 5 | 8 |
| 系统管理 | 8 | 2 | 3 | 3 | 6 |
| 性能测试 | 10 | 0 | 8 | 2 | 10 |
| 安全测试 | 15 | 6 | 7 | 2 | 14 |
| **总计** | **108** | **23** | **46** | **39** | **96** |

### 10.2 测试覆盖率目标

- **单元测试覆盖率**: ≥80%
- **集成测试覆盖率**: ≥70%
- **E2E 测试**: 关键路径 100%
- **自动化率**: ≥88% (96/108)

---

## 11. 附录

### 11.1 测试环境信息
- 测试服务器: staging.claw.ai
- 数据库版本: PostgreSQL 15
- Redis 版本: 7
- 浏览器: Chrome, Firefox, Safari, Edge 最新版

### 11.2 测试工具
- 单元测试: pytest, Vitest
- API 测试: httpx, supertest
- E2E 测试: Playwright
- 性能测试: Locust
- 安全测试: OWASP ZAP, Bandit, Snyk

### 11.3 测试数据
详见测试环境配置文件

---

**文档审批**:
- QA Team Lead: ___________  日期: _________
- 项目经理: ___________  日期: _________
